<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Photo Detail</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="album.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    /* album-container 内の写真を横並びにする */
    #album-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 20px auto;
      max-width: 800px;
    }

    #album-container img {
      width: 150px;
      height: 150px;
      object-fit: cover;
      margin: 10px;
      border-radius: 8px;
      border: 2px solid #ccc;
      transition: transform 0.2s;
    }

    #album-container img:hover {
      transform: scale(1.05);
    }
  </style>
</head>

<body>
   <div class="center">
    <div class="phone detail-phone">
  <h1>Photo Detail</h1>

  <!-- 元の仮の写真詳細 -->
  <div id="photo-detail"></div>

  <!-- アルバム写真を表示するコンテナ -->
  <div class="album-container" id="album-container"></div>

  <div id="comment-frame">
    <h3>コメント</h3>
    <textarea
      id="comment-text"
      placeholder="コメント"
      rows="5"
      style="width:100%;"
    ></textarea>
    <button id = "save-comment">保存</button>
  </div>

  <a href="album.html" class="btn">Back to Album</a>
  
  <div class="fixed-thumb">
  <img src="images/album_detail_ex4.png" alt="アルバム詳細画像">
</div>


  <script>
  // URLパラメータから星座名を取得
  const params = new URLSearchParams(window.location.search);
  const starName = params.get("star");

  console.log("starName =", starName);

  // ===== サーバーから星座フォルダ内の写真を取得して表示 =====
  async function loadAlbum() {
    try {
      // ★ APIは /images?star=○○
      const res = await fetch(`http://localhost:3000/images?star=${starName}`);
      const images = await res.json();

      const container = document.getElementById("album-container");
      container.innerHTML = ""; // 既存内容クリア

      if (!starName) {
        container.innerHTML = "<p>星座が指定されていません</p>";
        return;
      }

      if (images.length === 0) {
        container.innerHTML = "<p>まだ写真がありません</p>";
        return;
      }

      const photoDetail = document.getElementById("photo-detail");
photoDetail.innerHTML = ""; // 中を空にする

  // 1枚目の写真だけを中央に表示
  const img = document.createElement("img");
  img.src = `http://localhost:3000${images[0]}`;
  img.style.width = "100%";
  img.style.height = "100%";
  img.style.objectFit = "cover";

  photoDetail.appendChild(img);


    } catch (err) {
      console.error(err);
      document.getElementById("album-container").innerHTML =
        "<p>写真がありません</p>";
    }
  }

  loadAlbum();

  // コメントの追加
  async function loadComment() {
    const res = await fetch(
      `http://localhost:3000/albums/${starName}/comment`
    );
    const data = await res.json();
    document.getElementById("comment-text").value = data.content;
  }

  document
    .getElementById("save-comment")
    .addEventListener("click", async () => {
      const content = document.getElementById("comment-text").value;
      await fetch(
        `http://localhost:3000/albums/${starName}/comment`,
        {
          method: "PUT",
          headers:{
            "Content-Type": "application/json"
          },
          body: JSON.stringify({content})
        }
      );
      alert("コメントを保存しました");
    });
  loadComment();
</script>
 </div>
  </div>
</body>
</html>
